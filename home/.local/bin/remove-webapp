#!/bin/bash

set -e

ICON_DIR="$HOME/.local/share/icons/webapps"
DESKTOP_DIR="$HOME/.local/share/applications"

if (( $# < 1 )); then
  echo -e "\e[32mLet's remove a web app launcher.\n\e[0m"

  # List available web apps
  DESKTOP_FILES=("$DESKTOP_DIR"/*.desktop)
  if [[ ! -e ${DESKTOP_FILES[0]} ]]; then
    echo -e "\e[31mNo web apps found.\e[0m"
    exit 1
  fi

  # Extract app names from desktop files
  APP_OPTIONS=()
  for file in "$DESKTOP_DIR"/*.desktop; do
    basename="${file##*/}"
    app_name="${basename%.desktop}"
    APP_OPTIONS+=("$app_name")
  done

  if command -v gum &>/dev/null; then
    APP_NAME=$(printf '%s\n' "${APP_OPTIONS[@]}" | gum choose --header "Select app to remove")
  else
    echo "Available apps:"
    select APP_NAME in "${APP_OPTIONS[@]}"; do
      if [[ -n $APP_NAME ]]; then
        break
      fi
    done
  fi

  if [[ -z $APP_NAME ]]; then
    echo -e "\e[31mNo app selected.\e[0m"
    exit 1
  fi
else
  APP_NAME="$1"
fi

DESKTOP_FILE="$DESKTOP_DIR/$APP_NAME.desktop"
ICON_FILE="$ICON_DIR/$APP_NAME.png"

if [[ ! -f $DESKTOP_FILE ]]; then
  echo -e "\e[31mError: Web app '$APP_NAME' not found.\e[0m"
  exit 1
fi

rm -f "$DESKTOP_FILE"
echo -e "\e[32m✓ Removed desktop entry for $APP_NAME\e[0m"

if [[ -f $ICON_FILE ]]; then
  rm -f "$ICON_FILE"
  echo -e "\e[32m✓ Removed icon for $APP_NAME\e[0m"
fi

echo -e "\e[32m✓ $APP_NAME uninstalled\e[0m"

# vim: ft=sh
